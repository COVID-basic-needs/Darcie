version: '3.3'

services:
  traefik:
    image: traefik:v2.1 # The official v2 Traefik docker image
    command:
      - "--api.insecure=true" # Enables the web UI, Traefik will listen on port 8080 by default for API request.
      - "--providers.docker=true" # tells Traefik to listen to docker
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80" # Traefik will listen to incoming request on the port 80 (HTTP)
    ports:
      - "80:80" # The HTTP port
      - "443:443"
      - "8080:8080" # The Web UI (enabled by --api.insecure=true)
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # So that Traefik can listen to the Docker events
  soe:
    image: vacs-soe
    build: ./soe
    labels:
      - "traefik.enable=true" # Explicitly tell Traefik to expose this container
      - "traefik.http.routers.soe.rule=Host(`soe.localhost`)" # The domain the service will respond to
      - "traefik.http.routers.seo.entrypoints=web" # Allow request only from the predefined entry point named "web"
    depends_on:
      - landingpage
      # - redis
    environment:
      NODE_ENV: production
    ports:
      - "8000:8000"
  watson_webhook:
    image: watson_webhook
    build: ./watson_webhook
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.watson_webhook.rule=Host(`watson_webhook.localhost`)"
      - "traefik.http.routers.watson_webhook.entrypoints=web"
    environment:
      NODE_ENV: production
    ports:
      - "5000:5000"
  landingpage:
    image: vacs-landingpage
    build: ./landingpage
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.landingpage.rule=Host(`landingpage.localhost`)"
      - "traefik.http.routers.landingpage.entrypoints=web"
    ports:
      - "8181:8181"
      - "9191:9191/udp"
  # redis:
  #   image: redis:6.0-rc1-alpine3.11
